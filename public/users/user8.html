<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User 8</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.9/mammoth.browser.min.js"></script>  
    <link rel="shortcut icon" href="../images/logo.png" type="image/x-icon">
    <link rel="stylesheet" href="../css/main-css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css" />
    <link href="https://fonts.cdnfonts.com/css/script-mt?styles=95594" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
</head>
<body>
    <div class="admin-container">
        <div class="topbar">
            <div class="logo">
                <img src="../images/logo.png" alt="">
                <h2 >FAR EAST FUEL CORPORATION</h2>
            </div>
        </div>
        <div class="sidebar">
            <ul>
                <div id="user_sidebar"></div>
                <div id="user_sidebar_officer"></div>
                <div id="user_sidebar_department"></div>
                <li class="hover">
                    <a href="#">
                        <i class="fas fa-th-large"></i>
                        Dashboard
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fa-solid fa-person-falling-burst"></i>
                        Incident Documentation
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-cog"></i>
                        Settings
                    </a>
                </li>
                <li>
                    <a href="#">
                        <i class="fas fa-question"></i>
                        Help
                    </a>
                </li>
                <li>
                    <a href="https://fareastfuelcorporation.github.io/System/">
                        <i class="fa-solid fa-power-off"></i>
                        Logout
                    </a>
                </li>
            </ul>
        </div>
        <div class="main">
            <div class="header_date_time">
                <div class="header_date">
                    <div id="exactDate"></div>
                </div>
                <div class="header_time">
                    <div id="exactTime"></div>    
                </div>
            </div>
            <div class="back_button">
                <button onclick="goBack()">
                    <i class="fa-solid fa-arrow-left"></i>
                </button>
            </div>
            <div class="refresh_button">
                <button onclick="refreshPage()">
                    <i class="fa-solid fa-arrows-rotate"></i>
                </button>
            </div>
            <!-- safety_dashboard -->
            <section class="safety" id="safety_dashboard">
                <h2>DASHBOARD</h2><br>
                <h2>INCIDENT REPORT SUMMARY</h2>
                <div class="cards">
                    <div class="card">
                        <div class="card-content">
                            <div class="number" id="incident_report"></div>
                            <div class="card-name">Incident Report</div>
                        </div>
                        <div class="icon-box">
                            <i class="fa-solid fa-person-falling-burst"></i>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <div class="number" id="pending_counter"></div>
                            <div class="card-name">Pending</div>
                        </div>
                        <div class="icon-box">
                            <i class="fa-solid fa-clipboard-list"></i>
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-content">
                            <div class="number" id="documented"></div>
                            <div class="card-name">Documented</div>
                        </div>
                        <div class="icon-box">
                            <i class="fa-solid fa-clipboard-check"></i>
                        </div>
                    </div>
                </div><br>
                <h2>INCIDENT REPORTS</h2>
                <div class="table" style="max-height: 40vh; align-items: start; overflow-y: scroll;">                            
                    <div class="list">
                        <table>
                            <thead style="position: sticky; top: 0; background-color: black;">
                                <th>#</th>
                                <th>IRF #</th>
                                <th>INCIDENT<br>DATE/TIME</th>
                                <th>DEPARTMENT</th>
                                <th>PERSON<br>INVOLVE</th>
                                <th>DESIGNATION</th>
                                <th>INCIDENT DETAILS</th>
                                <th>REPORT<br>DATE/TIME</th>
                                <th>DURATION<br>REPORT</th>
                            </thead>
                            <tbody id="pending_list">

                            </tbody>
                        </table>
                        <div class="text-center text_end">>>>>>>>>>> END OF LIST <<<<<<<<<<</div>
                    </div>
                </div><br>
                <h2>INCIDENT HISTORY LIST</h2>
                <div class="table" style="max-height: 40vh; align-items: start; overflow-y: scroll;">                            
                    <div class="list">
                        <table>
                            <thead style="position: sticky; top: 0; background-color: black;">
                                <th>#</th>
                                <th>IRF #</th>
                                <th>INCIDENT<br>DATE/TIME</th>
                                <th>DEPARTMENT</th>
                                <th>PERSON<br>INVOLVE</th>
                                <th>DESIGNATION</th>
                                <th>INCIDENT DETAILS</th>
                                <th>ACTION TAKEN</th>
                                <th>REPORT<br>DATE/TIME</th>
                                <th>DURATION<br>REPORT</th>
                            </thead>
                            <tbody id="incident_history_list">

                            </tbody>
                        </table>
                        <div class="text-center text_end">>>>>>>>>>> END OF LIST <<<<<<<<<<</div>
                    </div>
                </div><br>
            </section>
            <!-- incident_report_form -->
            <section class="safety" id="incident_documentation_form">
                <h2>INCIDENT DOCUMENTATION FORM</h2><br>
                <form action="" method="post">
                    <input type="hidden" name="user" id="user">
                    <div class="idf_form">
                        <div>
                            <label for="search_irf_form_no">
                                <i class="fa-solid fa-list-ol"></i>
                                Search IRF #
                            </label>
                            <div class="idf_form">
                                <div class="form">
                                    <input type="text" id="search_irf_form_no" autocomplete="off" name="search_irf_form_no" class="form-control"><br>
                                </div>
                                <div>
                                    <button id="search_irf_form_no_button" class="form-control" type="button">
                                        <i class="fa-solid fa-magnifying-glass" style="color: #ffffff;"></i>
                                    </button>
                                </div>
                                <div>
                                    <button id="clear_irf_form_no_button" type="button" class="form-control">
                                        <i class="fa-solid fa-rectangle-xmark" style="color: #ffffff;"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="search_irf_result">
    
                    </div>
                    <div id="head_button">
                        <label for="unsafe_act_condition">
                            <i class="fa-solid fa-list-ol"></i>
                            Type of Form
                        </label>
                        <div class="head_button">
                            <button type="button" class="form-control" id="unsafe_act_condition">
                                Unsafe Act/Condition Report
                            </button>
                            <button type="button" class="form-control" id="near_miss">
                                Near-Miss Report
                            </button>
                            <button type="button" class="form-control" id="accident">
                                Accident Report
                            </button>
                        </div>
                        <hr>
                    </div>
                    <div id="form_details">
                        <div class="flex">
                            <div id="uarf_form">
                                <label for="uarf_form_no">
                                    <i class="fa-solid fa-list-ol"></i>
                                    UARF #
                                </label><br>
                                <div class="form">
                                    <input type="text" id="uarf_form_no" autocomplete="off" name="uarf_form_no" class="form-control" readonly><br>
                                </div>
                            </div>
                            <div id="nmrf_form">
                                <label for="nmrf_form_no">
                                    <i class="fa-solid fa-list-ol"></i>
                                    NMRF #
                                </label><br>
                                <div class="form">
                                    <input type="text" id="nmrf_form_no" autocomplete="off" name="nmrf_form_no" class="form-control" readonly><br>
                                </div>
                            </div>
                            <div id="airf_form">
                                <label for="airf_form_no">
                                    <i class="fa-solid fa-list-ol"></i>
                                    AIRF #
                                </label><br>
                                <div class="form">
                                    <input type="text" id="airf_form_no" autocomplete="off" name="airf_form_no" class="form-control" readonly><br>
                                </div>
                            </div>
                        </div>
                        <div id="file_input_container" style="display: none;">
                            <label for="identified_hazard">
                                <i class="fa-solid fa-user"></i>
                                Identified Hazard:
                            </label><br>
                            <textarea name="identified_hazard" id="identified_hazard" class="form-control" cols="30" autocomplete="off" required placeholder="Input Identified Hazard..." rows="10"></textarea><br>
                            <label for="potential_harm">
                                <i class="fa-solid fa-user"></i>
                                Potential Harm:
                            </label><br>
                            <textarea name="potential_harm" id="potential_harm" class="form-control" cols="30" autocomplete="off" required placeholder="Input  Potential Harm..." rows="5"></textarea><br>
                            <label for="identified_hazard">
                                <i class="fa-solid fa-user"></i>
                                Recommendation / Control Measure:
                            </label><br>
                            <textarea name="recommendation" id="recommendation" class="form-control" cols="30" autocomplete="off" required placeholder="Input Recommendation / Control Measure..." rows="10"></textarea><br>
                            <label for="fileInput">
                                <i class="fa-solid fa-photo-film"></i>
                                Attachement 1
                            </label><br>
                            <input type="file" name="fileInput" id="fileInput" onchange="displayFile()"><br>
                            <label for="fileInput">
                                <i class="fa-solid fa-photo-film"></i>
                                Attachement 2
                            </label><br>
                            <input type="file" name="fileInput2" id="fileInput2" multiple onchange="displayFiles()">
                        </div>
                        <div class="buttons">
                            <button type="button" id="generate_btn" class="form-control" >
                                Generate
                            </button>
                        </div> 
                    </div>
                    <button type="button" id="generate_report_btn" class="form-control" style="display: none; max-width: none; width: max-content;" onclick="executeMultipleFunctions()">Download PDF</button>
                    

                    
                </form>
            </section>
            <!-- settings -->
            <section id="settingsSection">
                <h2>SETTINGS</h2><br>
            </section>
            </section>
            <!-- help -->
            <section id="helpSection">
                <h2>HELP</h2><br>
            </section>
        </div>
    </div>
    <script>
        function displayFile() {
            const fileInput = document.getElementById('fileInput');
            const fileDisplayArea = document.getElementById('fileDisplayArea');
            
            // Check if a file is selected
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                
                // Check if the file is an image
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    
                    reader.onload = function(event) {
                        // Create an image element and set its source
                        const img = document.createElement('img');
                        img.src = event.target.result;
                        
                        // Clear any previous content and append the image
                        fileDisplayArea.innerHTML = '';
                        fileDisplayArea.appendChild(img);
                    };
                    
                    // Read the file as a data URL
                    reader.readAsDataURL(file);
                } else {
                    fileDisplayArea.textContent = "Selected file is not an image.";
                }
            } else {
                fileDisplayArea.textContent = "No file selected.";
            }
        }
        function displayFiles() {
            const fileInput = document.getElementById('fileInput2');
            const fileDisplayArea = document.getElementById('fileDisplayArea2');
            
            // Clear any previous content
            fileDisplayArea.innerHTML = '';
            // var item_length = fileInput.files.length > 3 ? 3 : fileInput.files.length;

            // Check if files are selected
            if (fileInput.files.length > 0) {
                for (let i = 0; i < fileInput.files.length; i++) {
                    const file = fileInput.files[i];

                    // Check if the file is an image
                    if (file.type.startsWith('image/')) {
                        const reader = new FileReader();

                        reader.onload = function(event) {
                            // Create an image element and set its source
                            const img = document.createElement('img');
                            img.src = event.target.result;

                            // Apply styles to the image
                            img.style.maxHeight = `400px`;
                            img.style.maxWidth = `calc(700px / ${fileInput.files.length})`;
                            img.style.width = `calc(700px / ${fileInput.files.length})`;
                            img.style.display = 'block';
                            img.style.margin = '0 auto';

                            // Append the image to the display area
                            fileDisplayArea.appendChild(img);
                        };

                        // Read the file as a data URL
                        reader.readAsDataURL(file);
                    } else {
                        // Display a message for non-image files
                        const message = document.createElement('p');
                        message.textContent = `File ${i + 1}: ${file.name} is not an image.`;
                        fileDisplayArea.appendChild(message);
                        fileDisplayArea.style.flex = "repeat"
                    }
                }
            } else {
                fileDisplayArea.textContent = "No files selected.";
            }
        }
    
        function executeMultipleFunctions() {
            convertToPDF();
            convertToPDF2();
        }

        function convertToPDF() {
            const element = document.getElementById('what_to_print');
            const search_irf_form_no = document.getElementById('search_irf_form_no').value;
            const opt = {
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 10 },
                jsPDF: { unit: 'mm', format: 'letter', orientation: 'portrait' }
            };

            const marginTop = 32.5; // Top margin in mm
            const pageHeight = 236.9; // Adjust the value based on your available space for each page

            const totalPages = 1;

            let promises = [];

            for (let i = 0; i < totalPages; i++) {
                const promise = html2pdf()
                .set(opt)
                .from(element)
                .toContainer()
                .then(() => {
                    const newPosition = -pageHeight * (i + 1) - marginTop;
                    element.style.transform = `translate(0, ${newPosition}px)`;
                });

                promises.push(promise);
            }

            Promise.all(promises)
                .then(() => {
                element.style.transform = 'none';
                html2pdf().set(opt).from(element).save(`${search_irf_form_no}_page_1.pdf`).then(() => {
                    // Call the submit button click event immediately after the PDF is downloaded
                });
            });
        }
        function convertToPDF2() {
            const element = document.getElementById('what_to_print2');
            const search_irf_form_no = document.getElementById('search_irf_form_no').value;
            const opt = {
                image: { type: 'jpeg', quality: 1 },
                html2canvas: { scale: 5 },
                jsPDF: { unit: 'mm', format: 'letter', orientation: 'portrait' }
            };

            const marginTop = 32.5; // Top margin in mm
            const pageHeight = 236.9; // Adjust the value based on your available space for each page

            const totalPages = 1;

            let promises = [];

            for (let i = 0; i < totalPages; i++) {
                const promise = html2pdf()
                .set(opt)
                .from(element)
                .toContainer()
                .then(() => {
                    const newPosition = -pageHeight * (i + 1) - marginTop;
                    element.style.transform = `translate(0, ${newPosition}px)`;
                });

                promises.push(promise);
            }

            Promise.all(promises)
                .then(() => {
                element.style.transform = 'none';
                html2pdf().set(opt).from(element).save(`${search_irf_form_no}_page_2.pdf`).then(() => {
                    // Call the submit button click event immediately after the PDF is downloaded
                });
            });
        }

    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe" crossorigin="anonymous"></script>
    <script src="../js/main.js"></script>
    <script src="../js/user8.js"></script>
</body>
</html>